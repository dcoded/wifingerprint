#include <wifi.h>

std::vector<AccessPoint> ScanAir(const std::string& interfaceName)
{
    NSAutoreleasePool *pool = [NSAutoreleasePool new];

    CWInterface* interface = [[CWWiFiClient sharedWiFiClient] interface];

    NSError* error = nil;
    NSArray* scanResult = [[interface scanForNetworksWithSSID:nil error:&error] allObjects];
    if (error)
    {
        NSLog(@"%@ (%ld)", [error localizedDescription], [error code]);
    }

    std::vector<AccessPoint> result;
    for (CWNetwork* network in scanResult)
    {
        AccessPoint ap;
        ap.ssid  = std::string([[network ssid] UTF8String]);
        ap.bssid = std::string([[network bssid] UTF8String]);
        ap.rssi = [network rssiValue];
        result.push_back(ap);
    }

    [pool drain];
    return result;
}